defaults: &defaults
  working_directory: '~/project'

dependencies: &dependencies
  pre:
    - curl -o- -L https://yarnpkg.com/install.sh | bash
  cache_directories:
    - ~/.yarn-cache
  override:
    - yarn bootstrap

#########################JOBS########################################
version: 2
jobs:
  build:
    <<: *defaults
    docker:
      - image: node:8.9.4
    steps:
      - checkout
      - run:
          name: 'Install yarn'
          command: |
            npm install yarn@0.27.5
      - run:
          name: 'Install Lerna'
          command: |
            yarn add lerna

      - restore_cache:
          keys:
            - dependencies-{{ .Branch }}-{{ checksum "rocket-api/yarn.lock" }}-{{ checksum "mock-api/yarn.lock"}}
            - dependencies-{{ .Branch }}-{{ checksum "rocket-api/yarn.lock" }}
            - dependencies-{{ .Branch }}
            - dependencies
      - run:
          name: 'Install Dependencies'
          command: |
            yarn run bootstrap

      - save_cache:
          key: dependencies-{{ .Branch }}-{{ checksum "rocket-api/yarn.lock" }}-{{ checksum "mock-api/yarn.lock"}}
          paths:
            - node_modules
            - rocket-api/node_modules
            - mock-api/node_modules

############################WORKFLOWS###################################
workflows:
  version: 2

  pipeline:
    jobs:
      - build
